# FirebaseRawSender

Peque√±a librer√≠a de ayuda para enviar lecturas de dispositivos (IoT, wearables, sensores m√©dicos, etc.) a **Firebase Realtime Database** de forma sencilla y segura.

## Caracter√≠sticas

- üîë **Autenticaci√≥n autom√°tica** con Firebase Auth (m√©todo correo/contrase√±a).  
- üì§ **Env√≠o inmediato** de mediciones mediante `send_measurement(temperature, bmp, spo2)`.  
- üß© **`send_raw(payload)`** para mandar cualquier diccionario personalizado.  
- ‚ôªÔ∏è Reutiliza `requests.Session` para conexiones HTTP persistentes.  
- ‚ö†Ô∏è Manejo de errores HTTP con `raise_for_status()` y mensajes claros.  
- ü™∂ C√≥digo independiente, sin dependencias externas (solo `requests`).

---

## Instalaci√≥n

Requiere **Python¬†‚â•¬†3.10**.

```bash
pip install requests
```

Clona este repositorio o copia `firebase_raw_sender.py` a tu proyecto.

---

## Configuraci√≥n de Firebase Realtime Database

1. Accede a [Firebase Console](https://console.firebase.google.com/) y crea un **nuevo proyecto** (o usa uno existente).
2. En el men√∫ de la izquierda selecciona **Build ‚ñ∏ Realtime Database** y pulsa **Create Database**.  
   - Elige la ubicaci√≥n m√°s cercana a tus usuarios.  
   - Selecciona el modo **Locked** (*Start in locked mode*) para que se apliquen reglas de seguridad.
3. Anota la **Database URL** que aparece en la parte superior (formato `https://<TU-PROYECTO>.firebaseio.com`); la necesitar√°s como `database_url`.
4. Abre la pesta√±a **Rules** y sustituye el contenido por:

```json
{
  "rules": {
    ".read": "auth != null",
    ".write": "auth.uid === '<YOUR_AUTH_ID>'"
  }
}
```

   - Reemplaza `<YOUR_AUTH_ID>` por el `uid` del usuario autorizado a escribir.  
     Puedes obtener tu `uid` desde **Build ‚ñ∏ Authentication ‚ñ∏ Users** despu√©s de crear el usuario.
5. En **Build ‚ñ∏ Authentication ‚ñ∏ Sign‚Äëin method** habilita **Email/Password** y crea el usuario que utilizar√°s desde tu dispositivo o aplicaci√≥n.
6. Dir√≠gete a **Project settings ‚ñ∏ General** y copia el valor **Web API key** para usarlo como `api_key` en el c√≥digo.

---

## Uso r√°pido

```python
from firebase_raw_sender import FirebaseRawSender

sender = FirebaseRawSender(
    email="usuario@ejemplo.com",
    password="TU_PASSWORD",
    api_key="TU_API_KEY_DE_FIREBASE",
    database_url="https://<TU-PROYECTO>.firebaseio.com",
)

# Env√≠a una medici√≥n concreta
sender.send_measurement(temperature=36.6, bmp=72, spo2=98, modelPreccision = 90.5, riskScore = 0.3)

# O un payload arbitrario
sender.send_raw({"pressure": 1011, "nota": "prueba"})
```

---

## Ejemplos avanzados

| Escenario                            | C√≥digo / Idea principal                                                                               |
|--------------------------------------|--------------------------------------------------------------------------------------------------------|
| **Enviar varias variables adicionales** | `payload = {"temp": 25.4, "hum": 40, "uv": 3.1}; sender.send_raw(payload)`                           |
| **Timestamp personalizado**          | `sender.send_measurement(36.5, 80, 97, timestamp_ms=1722600000000)`                                   |
| **Reautenticaci√≥n manual**           | Simplemente llama `sender._authenticate()` si necesitas forzar el refresh del idToken.                |
| **Uso en multihilo / asyncio**       | Instancia la clase en el hilo principal y pasa la misma instancia a los hilos / corrutinas hijas.     |

---

## Variables de entorno (opcional)

Para evitar hardcodear credenciales puedes usar variables de entorno:

| Variable              | Descripci√≥n                               |
|-----------------------|-------------------------------------------|
| `FIREBASE_EMAIL`      | Correo de la cuenta de servicio / usuario |
| `FIREBASE_PASSWORD`   | Contrase√±a de la cuenta                   |
| `FIREBASE_API_KEY`    | API key p√∫blica del proyecto de Firebase  |
| `FIREBASE_DB_URL`     | URL de la Realtime Database               |

---

## Contribuciones

¬°Las *pull requests* son bienvenidas!  
Abre un *issue* para reportar bugs o proponer mejoras.

---

## Licencia

Distribuido bajo la licencia **MIT**.  
Consulta el archivo [LICENSE](LICENSE) para m√°s detalles.
