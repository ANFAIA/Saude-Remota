import math

# ==== 1. Cargar pesos y biases ====
# Estos valores los exportar√°s manualmente del archivo .npy en formato listas
# ==== PESOS DEL MODELO ====

W1 = [[-0.0149302426725626, 0.004644491709768772, 0.4543401300907135, -0.19438354671001434, -0.4048958122730255, -0.16506311297416687, -0.2792957127094269, 0.504680335521698, -0.5038942694664001, -0.4616812467575073, -0.44208472967147827, 0.49664419889450073, -0.25934556126594543, -0.34472858905792236, 0.18703287839889526, -0.2682269513607025, 0.06653293967247009, -0.46973568201065063, -0.006142335012555122, -0.13167189061641693, -0.11548598110675812, 0.15188944339752197, -0.3117322325706482, -0.05249183997511864, -0.40323978662490845, -0.28069648146629333, -0.13653944432735443, -0.19590157270431519, 0.3168967366218567, -0.34744662046432495, -0.09870597720146179, -0.22730322182178497], [0.47425949573516846, 0.2882460951805115, -0.01890157163143158, -0.1558750867843628, -0.08453213423490524, 0.4964998960494995, -0.08242269605398178, -0.35395145416259766, -0.46755871176719666, -0.42128369212150574, 0.0841231569647789, 0.0206802599132061, 0.5758985280990601, 0.40885213017463684, -0.11298452317714691, -0.27098777890205383, -0.26250460743904114, 0.014195782132446766, 0.27405086159706116, -0.2392667680978775, -0.07093146443367004, -0.37603142857551575, 0.6046721339225769, 0.5224652290344238, -0.2883390486240387, 0.0150702940300107, 0.39646685123443604, 0.40939217805862427, -0.1862225979566574, 0.04091522842645645, 0.4589853584766388, 0.3921876847743988], [-0.457836776971817, -0.38238686323165894, -0.08692295104265213, 0.27730807662010193, 0.19861310720443726, 0.46182820200920105, 0.12296909838914871, 0.2484678477048874, -0.009071742184460163, -0.23163384199142456, -0.2075924426317215, 0.05018826946616173, -0.0016976817278191447, -0.4559314250946045, -0.11287233233451843, -0.4683469235897064, 0.3203425407409668, -0.30316242575645447, 0.3185291290283203, 0.15675966441631317, 0.25434407591819763, -0.3307739198207855, 0.01603861339390278, 0.11423837393522263, -0.24635563790798187, 0.07467219978570938, 0.29412171244621277, -0.431325763463974, 0.28540876507759094, 0.3297819495201111, 0.18943433463573456, -0.3229682743549347]]  
b1 = [-0.048719555139541626, -0.02708624117076397, 0.1652013659477234, -0.05415848642587662, 0.10169177502393723, 0.0742197036743164, -0.05129339545965195, 0.1390489935874939, 0.1687912940979004, 0.09570669382810593, 0.24873848259449005, 0.1778668910264969, 0.1256345510482788, 0.24341832101345062, 0.06749045848846436, 0.10188733786344528, -0.04494590684771538, 0.2711430788040161, -0.003231998300179839, -0.09360084682703018, -0.08589501678943634, 0.16185443103313446, 0.156790629029274, -0.002814599545672536, 0.12712377309799194, 0.2075384557247162, 0.10556484758853912, 0.1114397644996643, 0.054606202989816666, 0.22056356072425842, 0.03385243937373161, 0.1288328915834427]

W2 = [[0.3406880497932434, -0.09391257166862488, -0.05047095566987991, 0.5471903085708618, -0.1923155039548874, 0.023775584995746613, -0.04320526123046875, 0.22387759387493134, -0.2587823271751404, -0.06314393877983093, -0.06736299395561218, -0.4623430669307709, 0.14735578000545502, 0.13936133682727814, 0.12512947618961334, 0.15656764805316925], [-0.05346016585826874, 0.026433981955051422, 0.20953604578971863, 0.04529733583331108, 0.08368293195962906, -0.05086435005068779, 0.03813496232032776, 0.07255885750055313, 0.14731667935848236, -0.351505845785141, -0.0649724081158638, -0.09620094299316406, -0.33461472392082214, -0.030908437445759773, 0.36097171902656555, 0.5279201865196228], [-0.18705138564109802, 0.09002900123596191, 0.41322800517082214, 0.0029184608720242977, 0.1388930231332779, -0.22879478335380554, 0.20598089694976807, -0.1364603042602539, -0.15336044132709503, 0.2726326882839203, -0.21593670547008514, 0.2754107415676117, 0.4776710569858551, -0.04408964142203331, -0.08579966425895691, -0.09941138327121735], [-0.16067497432231903, -0.14301975071430206, 0.28575822710990906, 0.16417674720287323, 0.09779110550880432, 0.35860487818717957, 0.047248706221580505, 0.25132185220718384, -0.20087800920009613, 0.23540189862251282, 0.2744419574737549, 0.28763753175735474, 0.17710521817207336, 0.03553793951869011, 0.24193045496940613, 0.30151891708374023], [0.07789118587970734, 0.423554003238678, 0.2687184810638428, 0.3295871913433075, 0.22227229177951813, 0.08098085224628448, 0.4822498857975006, -0.10054293274879456, 0.26703009009361267, -0.30814507603645325, 0.16332100331783295, 0.2335437536239624, 0.2584666609764099, 0.16221553087234497, 0.3877229392528534, 0.35017332434654236], [0.44260844588279724, 0.03326622396707535, 0.14352178573608398, 0.11766000092029572, -0.012630767188966274, 0.13408122956752777, -0.05542413145303726, -0.1394672840833664, 0.17145901918411255, -0.38410064578056335, 0.18423078954219818, -0.1982215940952301, -0.3273053765296936, -0.3109886646270752, 0.2744498550891876, 0.06869620084762573], [-0.04195928946137428, -0.2446203976869583, -0.41495421528816223, 0.11315009742975235, -0.15977945923805237, -0.10811810195446014, 0.2721036970615387, 0.0916544497013092, -0.3596082329750061, 0.16982293128967285, 0.3237854242324829, 0.2065446674823761, 0.2596290707588196, 0.1586526781320572, 0.11390601843595505, 0.1794927567243576], [-0.11702074110507965, -0.2844489514827728, 0.199135884642601, -0.24021194875240326, 0.24909824132919312, -0.2303103506565094, -0.22260542213916779, 0.5320761203765869, 0.43423938751220703, 0.177831768989563, -0.08691196143627167, 0.3426930606365204, 0.25907284021377563, -0.27893131971359253, -0.056658536195755005, -0.21979014575481415], [0.20430703461170197, 0.4533148407936096, -0.3802209794521332, 0.21956086158752441, -0.08497949689626694, 0.5746992230415344, 0.236385315656662, -0.10460212081670761, -0.3019419312477112, -0.11931635439395905, 0.4923359453678131, 0.028268758207559586, 0.20927558839321136, -0.054472487419843674, -0.21287304162979126, 0.2104213386774063], [0.39883914589881897, 0.135264053940773, 0.15848946571350098, 0.45381027460098267, -0.18186421692371368, 0.3142595589160919, 0.09498606622219086, -0.046050187200307846, -0.15056875348091125, -0.11433961987495422, 0.5537869334220886, -0.38542455434799194, 0.015571481548249722, -0.2916884422302246, -0.21115529537200928, 0.49679750204086304], [0.4048111140727997, 0.23112305998802185, -0.34356796741485596, -0.08715593069791794, -0.22564026713371277, 0.14523719251155853, 0.24877296388149261, -0.23927992582321167, 0.17519333958625793, -0.16300995647907257, 0.35308846831321716, -0.34540772438049316, -0.13448846340179443, 0.28797078132629395, -0.005762339569628239, -0.12316011637449265], [0.14496007561683655, 0.16017529368400574, 0.4446851909160614, -0.04397246986627579, 0.40794506669044495, -0.11441868543624878, -0.18919982016086578, -0.1080269142985344, -0.25396063923835754, 0.33979690074920654, -0.17186298966407776, 0.32174181938171387, -0.1895400583744049, -0.31085774302482605, 0.053394731134176254, 0.0736338272690773], [0.21204155683517456, 0.12962375581264496, -0.03557875379920006, 0.28000351786613464, -0.4369037449359894, 0.5583944320678711, 0.2910003066062927, -0.27042344212532043, -0.15884573757648468, -0.5182187557220459, -0.06710754334926605, -0.13868051767349243, 0.05142630264163017, 0.18581737577915192, -0.07712531834840775, 0.3707118034362793], [0.2595166563987732, 0.44063517451286316, -0.3889511227607727, 0.16316062211990356, -0.40508511662483215, 0.47473061084747314, 0.42049989104270935, 0.0044699180871248245, -0.3644019067287445, 0.03458510339260101, 0.1746971160173416, 0.14300747215747833, -0.35493266582489014, -0.19635453820228577, 0.23714059591293335, 0.5317659378051758], [-0.14506515860557556, -0.26960793137550354, -0.015807252377271652, 0.10181860625743866, 0.08466225862503052, 0.1527385115623474, -0.25691768527030945, -0.17465393245220184, 0.036772407591342926, 0.4432324767112732, 0.3016210198402405, -0.030522987246513367, -0.21107295155525208, -0.2459382861852646, -0.27310025691986084, 0.04517202451825142], [0.20056754350662231, 0.4731042683124542, 0.15833020210266113, 0.4433861970901489, -0.30369141697883606, -0.061083391308784485, 0.13303308188915253, 0.24200056493282318, -0.023176325485110283, -0.24338512122631073, 0.4000127613544464, 0.02670622617006302, 0.19181454181671143, -0.11369776725769043, 0.06233500689268112, 0.26654762029647827], [-0.2200930267572403, -0.25497081875801086, -0.3437247574329376, -0.23693427443504333, -0.1464902013540268, -0.08511663228273392, 0.07172103226184845, 0.04473639279603958, 0.234856516122818, 0.18711449205875397, 0.07554743438959122, 0.15716733038425446, -0.017661888152360916, 0.09180375188589096, 0.4209755063056946, -0.1966700404882431], [0.31254878640174866, -0.07655390352010727, -0.022942710667848587, 0.5549240708351135, -0.3483344316482544, 0.5559125542640686, 0.2772272229194641, -0.16514737904071808, -0.01160765253007412, -0.04320431500673294, 0.18695077300071716, -0.2186521291732788, -0.29658713936805725, 0.052470967173576355, 0.10312989354133606, 0.23954834043979645], [0.0929388552904129, -0.033654406666755676, -0.31587645411491394, 0.004504019394516945, -0.3369773328304291, 0.19772818684577942, 0.4149225056171417, 0.009557133540511131, 0.11586074531078339, 0.09552980959415436, 0.048096414655447006, 0.14904676377773285, 0.11853116750717163, 0.1125345528125763, 0.1712266206741333, 0.07900098711252213], [-0.07074560970067978, -0.15445110201835632, 0.24705447256565094, 0.13303928077220917, -0.028226731345057487, 0.042523063719272614, 0.27504268288612366, -0.336129754781723, -0.2835616171360016, 0.24039019644260406, 0.08609633147716522, 0.18815462291240692, -0.1309291273355484, 0.2969304621219635, 0.25595003366470337, -0.14814092218875885], [0.09815827012062073, -0.07131518423557281, 0.1951628178358078, -0.1197761669754982, -0.41082489490509033, -0.17237433791160583, 0.23860526084899902, -0.3584096133708954, -0.19598567485809326, -0.1980445832014084, 0.32795536518096924, 0.09531810879707336, 0.18240253627300262, -0.08970747888088226, -0.12033452093601227, -0.05958708003163338], [0.31819120049476624, 0.04792739823460579, -0.04011894389986992, 0.07492540776729584, 0.3610370457172394, 0.0378054715692997, 0.04307328909635544, -0.1501903235912323, 0.002794747008010745, 0.0803123340010643, 0.2473515421152115, 0.2465907335281372, -0.15281330049037933, 0.20824210345745087, -0.262723445892334, 0.20289604365825653], [0.47316059470176697, 0.3990401029586792, 0.13265331089496613, 0.30393701791763306, -0.43834537267684937, 0.2956768870353699, 0.3942248821258545, 0.12097416073083878, 0.11434029787778854, -0.005437017418444157, 0.24063937366008759, -0.0660495012998581, -0.17921055853366852, -0.15436150133609772, 0.4746525287628174, 0.5143842101097107], [0.3598655164241791, -0.011014371179044247, -0.4804787039756775, 0.37663042545318604, -0.11374818533658981, 0.38703128695487976, 0.011026842519640923, -0.2769823372364044, -0.2869439423084259, -0.3608567714691162, 0.26696979999542236, -0.045296888798475266, 0.2295863926410675, 0.2253275215625763, 0.24483615159988403, 0.5348472595214844], [-0.06626997143030167, 0.32432717084884644, 0.03449120745062828, 0.1681428700685501, -0.16966432332992554, 0.21248537302017212, 0.17550630867481232, -0.366751492023468, 0.12211985886096954, -0.23212085664272308, 0.22864335775375366, -0.2825338840484619, -0.13187840580940247, -0.1437384933233261, -0.2483760118484497, 0.36228665709495544], [0.10194279998540878, 0.44070518016815186, -0.4657513201236725, 0.5587289929389954, 0.08980782330036163, 0.00569577980786562, 0.13846388459205627, 0.21327891945838928, -0.3449539244174957, -0.0647321343421936, 0.4759707748889923, -0.3228839337825775, -0.28230467438697815, -0.21250979602336884, 0.07606057822704315, 0.13297125697135925], [0.062317825853824615, 0.24833229184150696, -0.0607905387878418, 0.5893284678459167, 0.005969202145934105, 0.1714947521686554, 0.40281814336776733, -0.1544041931629181, 0.07538285106420517, -0.07378614693880081, 0.379867821931839, -0.1946765035390854, -0.033132944256067276, -0.12651008367538452, 0.19220808148384094, 0.449185311794281], [0.4336225688457489, 0.5150807499885559, 0.18311801552772522, 0.1805022805929184, -0.470069944858551, 0.13271327316761017, 0.042298752814531326, -0.09655065834522247, 0.11027552932500839, -0.21997490525245667, 0.23246650397777557, -0.3160240352153778, -0.2747858464717865, 0.10953215509653091, 0.2641451060771942, 0.14463134109973907], [-0.2773309648036957, 0.021565454080700874, 0.16142460703849792, 0.10987810045480728, 0.1192270964384079, 0.08454859256744385, -0.17465853691101074, -0.17639605700969696, -0.1247844398021698, 0.40802595019340515, -0.25039032101631165, -0.1371922343969345, -0.043444015085697174, -0.21810294687747955, 0.20498104393482208, -0.24270685017108917], [0.13733041286468506, 0.3277357816696167, 0.18996834754943848, 0.11212962865829468, 0.24432839453220367, 0.1640048772096634, 0.39993467926979065, 0.21068115532398224, -0.25501349568367004, -0.16931495070457458, 0.16448068618774414, 0.0071553317829966545, -0.12586115300655365, -0.0726272463798523, 0.26689454913139343, 0.23716072738170624], [0.44583556056022644, 0.5355782508850098, -0.07357443869113922, -0.008009927347302437, -0.31588271260261536, 0.4679574966430664, -0.04754931479692459, -0.11129357665777206, 0.2783900499343872, -0.49294307827949524, 0.3922988772392273, -0.18631871044635773, 0.0841701328754425, -0.2469445914030075, -0.13715803623199463, -0.009607820771634579], [-0.045418232679367065, 0.4776069223880768, 0.1971186101436615, 0.004487210884690285, 0.03946731612086296, -0.04983193427324295, 0.34675994515419006, -0.31066665053367615, -0.2612774670124054, -0.14905141294002533, 0.18998801708221436, -0.069351926445961, 0.23395927250385284, -0.34285807609558105, 0.23678112030029297, 0.19703353941440582]]
b2 = [0.030392341315746307, 0.008876543492078781, 0.15087153017520905, 0.013497477397322655, 0.21268467605113983, 0.1141931563615799, 0.12862448394298553, 0.14143170416355133, 0.02642384171485901, 0.18544797599315643, 0.05624754726886749, 0.1508490890264511, 0.055780425667762756, -0.06745129823684692, 0.024137258529663086, 0.056833427399396896]

W3 = [[0.4831657409667969], [0.5263261198997498], [-0.3139927089214325], [0.37813159823417664], [-0.6766164302825928], [0.38665571808815], [0.31532007455825806], [-0.6867705583572388], [-0.18343549966812134], [-0.8251087069511414], [0.18915611505508423], [-0.7349976301193237], [-0.22553090751171112], [-0.3661258816719055], [0.7194467186927795], [0.33735862374305725]]  # capa final con 1 neurona
b3 = [-0.1691133677959442]

mean = [91.81403430301407, 84.86154882131669, 36.92420356026786]        # media del StandardScaler
scale = [5.740454253072095, 30.874583843871743, 1.459648607364617]      # desviaci√≥n t√≠pica

# ==== 2. Funciones auxiliares ====
def standardize(x):
    return [(x[i] - mean[i]) / scale[i] for i in range(len(x))]

def relu(x):
    return [max(0, i) for i in x]

def sigmoid(x):
    return 1 / (1 + math.exp(-x))

def dot(W, x, b):
    """Multiplicaci√≥n de matriz W (n_neuronas x n_entradas) * x + bias"""
    result = []
    for i in range(len(W[0])):  # para cada neurona
        s = 0
        for j in range(len(x)):
            s += x[j] * W[j][i]
        s += b[i]
        result.append(s)
    return result

# ==== 3. Funci√≥n de inferencia ====
def predict(features):
    # Estandarizar entrada
    x = standardize(features)

    # Capa 1
    z1 = dot(W1, x, b1)
    a1 = relu(z1)

    # Capa 2
    z2 = dot(W2, a1, b2)
    a2 = relu(z2)

    # Capa 3 (salida)
    z3 = 0
    for i in range(len(a2)):
        z3 += a2[i] * W3[i][0]
    z3 += b3[0]
    y = sigmoid(z3)

    # Umbral de clasificaci√≥n
    return 1 if y > 0.5 else 0, y
